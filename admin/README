----------------------------------------------------------------------------
-- PowerCounter 4.2.0. Счётчик с использованием MySQL                     --
----------------------------------------------------------------------------
Внимание!
Для обновления системы с версии 4.0.0 до версии 4.2.0 необходимо выполнить
SQL-запросы из файла update.sql
----------------------------------------------------------------------------
-- О PowerCounter                                                         --
----------------------------------------------------------------------------
Представляем вашему вниманию полнофункциональную систему контроля посещаемости
сайта. Web-приложение разработано при помощи PHP и представляет собой достаточно
мощную систему сбора и анализа информации о посетителях сайта. Данный счетчик
посетителей был разработан сотрудниками IT-студии SoftTime при активном участии
Левина А.В. (loki_angel@mail.ru,  http://alna.spb.ru), который буквально вдохнул
в него вторую жизнь.
В настоящий момент счётчик используется для сбора статистики и анализа схем
раскрутки многих сайтов, в том числе и http://www.softtime.ru. Это не просто
счётчик - это современный инструмент, позволяющий отслеживать потоки посетителей
на вашем сайте, сколько страниц они просматиривают, сколько времени пребывают
на сайте, откуда они попадают на ваш сайт, с других сайтов или с поисковых систем,
а какие ключевые слова используются? На все эти вопросы ответит данный счётчик.
Преимуществом встроенного счётчика является то, что он в отличие от внешних, 
таких как rambler.ru, mail.ru или hotlog фиксирует всех посетителей, а не 
тех, которые загрузили изображение-баннер. Поэтому из статистики вы узнаете и о том,
посещали ли вас роботы поисковых систем, или используют ли пользователи 
менеджеры закачек, чтобы передрать весь сайт себе на машину и больше вас не 
посещать :).
Счетчик посещений ведёт сбор информации о посетителях сайта, отображает общее
и засчитанное количество хостов, общее и засчитанное число хитов, как по
отдельным страницам, так и сайту в целом. Кроме того, производится сбор и
вывод информации об используемых посетителями операционных систем и браузеров.
Регистрируются посещения роботов наиболее известных поисковых систем: Yandex,
Rambler, Google, Aport и MSN, а так же страницы, которые они проиндексили.
Выводятся ключевые слова, по которым посетители нашили Ваш ресурс в поисковых
системах. Кроме того, ключевые слова сортируются по частоте запросов и вы 
может оценивать адекватность вашей аудитории. Грубо говоря, если ваш сайт
посвещён фиалкам, а вас находят по запросу "Цветной телевизор Горизонт",
можно быть уверенным, что посетитель не задержится на сайте дольше, чем 
требуется времени для нажатие на крестик в правом верхнем углу экрана, и 
нужно что-то срочно делать с оптимизацией страниц по поисковые системы.
Если эта работа вам в диковинку, вы можете обратится на форум IT-студии
SoftTime http://www.softtime.ru/forum/, который поддерживается авторами
нескольких книг по сетевому программированию. Вам обязательно помогут и
не будут предлагать преработать 20 000 страниц мануалов и прочесть 26 книг,
и лишь затем задавать вопросы. 
Счётчик посещений предоставляет возможность добавить адреса ресурсов, на
которых размещены ссылки на Ваш сайт, и отслеживать число посещений с них.
Информация предоставляется за 5 временных интервалов: "Сегодня", "Вчера",
"за 7 дней", "за 30 дней" и "за всё время". Для большинства отчётов выводится
посуточная, понедельная и помесячная статистика.

----------------------------------------------------------------------------
-- Что нового в PowerCounter 4.0                                          --
----------------------------------------------------------------------------
Система полностью переписана с использованием набора классов SoftTime FrameWork,
свежие версии которого можно найти по ссылке http://www.softtime.ru/info/framework_distrib.php
Набор классов описывается в книге "Кузнецов Максим, Симдянов Игорь. Объектно-
ориентированное программирование на PHP".
В версии 4.0 была исправлена подсистема сбора информации, позволяющая собирать
запросы ото всех поисковых систем в корректной кодировке.
Исправлен сбор статистики по поисковым роботам Google.
Значительно усилена усточнивость механизма архивации данных.
Разработана страница рефереров для текущего дня.
----------------------------------------------------------------------------
-- Что нового в PowerCounter 4.1                                          --
----------------------------------------------------------------------------
Исправлена ошибка отображения отчета "Системы и браузеры"
Введена подсистема для более точного учета IP-адресов, которую можно включить
при помощи константы IP_UNIQUE_USE в конфигурационном файле config.php
Поправлена главная страница
----------------------------------------------------------------------------
-- Что нового в PowerCounter 4.2                                          --
----------------------------------------------------------------------------
Добавлена возможность автоматической архивации базы данных по cron-заданию.
----------------------------------------------------------------------------
-- Инсталляция:                                                           --
----------------------------------------------------------------------------
Для успешного функционирования счётчика, необходимо создать базу данных (по
умолчанию count), в которой следует разместить таблицы из файла PowerCoutner.sql.
На разных хостингах базы данных создаются по-разному: посредством web-интерфейса,
по запросу администратору, командой SQL (create database count;).

Настройка соединения с базой данных осуществляется в файле config/config.php и count.php, в
которых необходимо выставить адрес сервера MySQL ($dblocation), имя базы данных
($dbname), имя пользователя ($dbuser) и пароль ($dbpasswd). Все четыре переменные
Вам должен предоставить хостинг. Для того, чтобы страница на сайте учитывалась
счётчиком необходимо в начало этой страницы включить файл count.php:
<?php
  require_once("count.php");
?>
как это продемонстрировано в тестовой странице index.php. Вы не ограничены выбором
места размещения этой конструкции. Догружает посетитель страницу до конца или нет
не имеет ровным счётом никакого значения - он будет подсчитан. Это связано с тем,
что PHP-код выполняется на сервере и пока не будет выполнен, клиенту ничего отправлено
не будет. Поэтому когда посетитель получает только первые байты, он уже учтён.
При первом же обращении к странице посетителем, в таблице pages будет создана
запись соответствующая этой странице и страница будет автоматически включена
в систему статистики. Количество подключаемых страниц не ограничено.

Если перед файлом включением файла при помощи инструкции require_once поместить
имя страницы в переменной $titlepage, в отчётах системы, данная страница будет
участвовать под этим именем. Более того, вы можете объединять несколько страниц
в одну строку, присваивая им одинаковые названия.
<?php
  $titlepage = "Название страницы";
  require_once("count.php");
?>

Отдельно следует упомянуть архивацию рабочих таблиц в суточные, недельные и
месячные таблицы. Сжатие происходит в после 0:00, при первом посещении страницы
администрирования. Однако вы можете самостоятельно заставить систему сжимать
данные по cron - за этот процесс ответственнен скрипт admin/archive.php. Привязав
его к cron вы заставите систему архивировать данные самостоятельно. Однако
если это вовсе не обязательно, вы можете просто посещать систему администрирования
время от времени и система сама всё сделает.

----------------------------------------------------------------------------
-- Проблемы при инсталляции:                                              --
----------------------------------------------------------------------------
Следует помнить, что сервера - это не клиентские машины с Windows XP, они
и их настройки часто отличаются друг от друга. Поэтому возникновение проблем
очень вероятно и связаны они в первую очередь с нестандартными серверными
настройками переменных.
Поэтому если что-то не считается и не учитывается, следует либо брать в руки
PHP-функцию phpinfo() и лезть в count.php и исправлять переменные на те,
которые вы откопате в отчёте phpinfo(), в тех.поддержке и т.п., либо если это
слишком сложно для вас (а копаться в чужом коде не просто и все это понимают)
вы можете смело обращаться на форум http://www.softtime.ru/forum/, где разработчики
PowerCounter помогут вам модифицировать count.php под ваш сервер.

----------------------------------------------------------------------------
-- Модификация:                                                           --
----------------------------------------------------------------------------
По умолчанию, счётчик считает страницы, отличающиеся только параметрами, за одну
страницу, например страницы
index.php?id=1
index.php?id=2
будут считаться как одна и та же страница, со всеми вытекающими. Для того, чтобы
такие страницы считались как разные необходимо заменить $_SERVER['PHP_SELF'] на
$_SERVER['REQUEST_URI'] в файле count.php. Для этого можно просто открыть файл
в блокноте и воспользоваться функцией автозамены.

По умолчанию, архивируются только 20 позиций рефереров, поисковых запросов
каждой из поисковых систем - увеличить этот объём можно изменив соответствующие
константы в admin/config.php.

В версиях счётчика до 3.1.1 отчёт с IP-адресами выполнялся достаточно долго.
Это связано с вызовом функции gethostbyaddr(), которая обращается к DNS-серверу
для каждого из IP-адресов. По умолчанию такой режим теперь отключён. Включить
его можно изменив значение константы HOST_BY_ADDR с 0 на 1 в конфигурационном
файле admin/config.php.

----------------------------------------------------------------------------
-- Сжатие базы данных по cron-заданию:                                    --
----------------------------------------------------------------------------
При штатной работе PowerCounter данные сжимаются в архивные таблицы при первом
заходе посетителя после полуночи. Это может быть неудобным из-за длительности
данной операции или привязки панели статистики сайта к архивным суточным 
таблицам. Для того, чтобы процесс архивации протекал автоматически, можно 
воспользоваться cron – планировщиком задач в UNIX-системах. У разных 
хост-провайдеров разный порядок постановки cron-заданий, который следует 
уточнить у службы технической поддержки или в OnLine-документации. 
В классическом варианте задание сводится к строке вида
0 5 * * * /home/path/to/file/power_counter/cron.php
Где последовательность 0 5 * * * означает что задание будет запускаться каждый
день в 0 часов 5 минут. После чего следует путь к скрипту cron.php (иногда его
может предварять путь к PHP-интерпретатору, это нужно уточнять на каждом 
хостинге отдельно). Файл cron.php должен быть помечен как исполняемый (права 
доступа: rwxr-xr-x или 0755).
Сам файл cron.php также нуждается в настройке. Для этого нужно настроить 
следующие параметры
<?php
  ...
  // Абсолютный путь к папке system_powercounter
  $abspath = "/home/.../www/dmn/system_powercounter/";

  // Адрес сервера
  $dblocation = "localhost";
  // Имя базы данных, на хостинге или локальной машине
  $dbname = "oop_site";
  // Имя пользователя базы данных
  $dbuser = "root";
  // и его пароль
  $dbpasswd = "";
  ...
?>
Последние четыре параметра относятся к базе данных, первый параметр настраивает
абсолютный путь к директории с библиотеками, нужными для сжатия базы данных. 
Так как PHP-интерпретатор в cron-заданиях действует вне среды сервера, скрипт 
не видит соседние файлы, поэтому путь в $abspath следует указывать абсолютный,
от начала диска (посмотреть его можно в отчетах функции phpinfo()).

----------------------------------------------------------------------------
-- Администрирование                                                      --
----------------------------------------------------------------------------
Контролировать посещаемость ресурса можно на странице администрирования счётчика
расположенной в папке dmn, на которую наложен пароль. По умолчанию логин root, пароль
также root. Изменить логин и пароль можно в разделе "Управление аккаунтами".

Для защиты используется basic-авторизация, которая не работает, если PHP подключен
как CGI-скрипт. В этом случае для защиты следует воспользоваться средствами
Web-сервера Apache. Подробнее об этом можно почитать в статье
http://www.softtime.ru/info/articlephp.php?id_article=27 или обратившись на форум
http://www.softtime.ru/forum/index.php?id_forum=5

Переход по ссылке "PowerCounter" приводит на главную страницу системы, где выводится список
страниц, участвующих в сборе статистики, напротив каждой, из которых приведёно общее
число хитов с момента регистрации статистики. Вверху имеется меню со ссылками на
страницы статистики. Переход по меню позволяет просмотреть статистку для всего сайта
в целом, в то время как переход по ссылкам из таблицы - статистику для каждой
конкретной страницы.

Меню состоит из следующих пунктов:
- "Почтовый отчёт",
- "Хиты и хосты" (посуточный, понедельный, помесячный отчёты),
- "Системы и браузеры" (посуточный, понедельный, помесячный отчёты),
- "IP-адреса" (посуточный, понедельный, помесячный отчёты),
- "Поисковые роботы" (посуточный, понедельный, помесячный отчёты),
- "Поисковые запросы" (посуточный, понедельный, помесячный отчёты),
- "Статистика поисковых запросов"
- "Ссылающиеся страницы",
- "Рефереры" (посуточный, понедельный, помесячный отчёты),
- "Точки входа",
- "Глубина просмотра" (посуточный, понедельный, помесячный отчёты),
- "Время сеанса" (посуточный, понедельный, помесячный отчёты).

Переход к странице "Почтовый отчёт"
приводит к странице, позволяющей отправить почтовые отчёты за вчерашний день, прошедшую
неделю, прошедший месяц на почтовый ящик администратора, задать который можно в константе
EMAIL_ADDRESS в конфигурационном файле admin/config.php.

Переход к странице "Хиты и хосты"
приводит к странице с таблицей, в которой указано количество хостов, засчитанное
и общее число хитов за 5 временных интервалов: "Сегодня", "Вчера", "за 7 дней",
"за 30 дней" и "за всё время" для данной страницы сайта. Переход по гиперссылкам
"Сегодня" и "Вчера" приводит к странице распределения хостов и хитов по часам в
эти дни. Соответственно, переход по гиперссылкам "за 7 дней" и "за 30 дней" приводит
к таблице с динамикой изменения количества хитов и хостов за неделю и за месяц.

Переход к странице "Системы и браузеры"
приводит к странице с таблицей, в которой указано количество посетителей использующих
в качестве операционных систем Windows, один из вариантов UNIX и Macintosh, а также
пользующихся браузерами Internet Explorer, Opera, Netscape, Firefox, MyIE и Mozilla
за 5 временных интервалов: "Сегодня", "Вчера", "за 7 дней", "за 30 дней" и "за всё время"
для данной страницы сайта. 

На странице "IP-адреса и хосты"
приводится таблица с IP-адресами посетителей за последние сутки. Для каждого IP-адреса
предоставляется информация о хосте, дате последнего посещения и общем числе посещений
с данного IP-адреса.

На странице "Поисковые роботы"
выводится таблица посещения ресурса роботами наиболее известных поисковых
систем (Yandex, Rambler, Google, Aport и MSN) за 5 временных интервалов: "Сегодня",
"Вчера", "за 7 дней", "за 30 дней" и "за всё время" для данной страницы сайта.
Кроме того, по ссылкам можно проследить какие страницы были проиндексированы
роботами поисковых систем.

На странице "Поисковые запросы"
выводится таблица с информацией о числе поисковых запросов и сами ключевые слова, по
которым ваш ресурс был обнаружен для поисковых систем Yandex, Rambler, Google, Aport,
Mail.ru и MSN), так и для каждой в отдельности. 

На странице "Статистика поисковых запросов"
выводится список ключевых слов, по которым посетители нашли ваш сайт в поисковых
системах. Кроме того, выводится частота использования ключевых слов посетителями.

На странице "Ссылающиеся страницы"
можно добавить адреса ресурсов, на которых расположены ссылки на Ваш сайт (например
каталоги вроде mail.ru), что позволит следить за посещаемостью сайта с этих ресурсов.

На странице "Рефереры"
выводятся адреса страниц, с которых на ваш сайт пришёл посетитель.

На странице "Точки входа"
можно определить наиболее популярные страницы вашего сайта, через которые посетители
попадают на ваш сайт, за счёт ссылок с других страниц или поисковых систем. Если при
общей высокой посещаемости сайта для каких-то страниц вы наблюдаете цифру 0 - эта 
страница не удачно спроектирована и через неё посетители не попадают на ваш ресурс.
Этот оригинальный сервис, не заменимый при раскрутке сайта разработан Левиным А.В.
(loki_angel@mail.ru).

На странице "Глубина просмотра"
можно выяснить интерес посетителей к вашему сайту. Данная страница предоставит информацию
о числе посетителей просмотревших 1, 2, 3 и т.д страниц вашего сайта. Статистика
выводится за 5 временных интервалов: "Сегодня", "Вчера", "за 7 дней", "за 30 дней"
и "за всё время". 

На странице "Время сеанса"
можно выяснить сколько времени проводят посетители на вашем сайте. Данная страница
предоставит информацию о числе посетителей пробывших на сайте 1, 2, 3 минуты ... или
возможно несколько часов. в и т.д страниц вашего сайта. Статистика выводится за 5
временных интервалов: "Сегодня", "Вчера", "за 7 дней", "за 30 дней" и "за всё время". 

Кроме того, на главной странице администрирования имеется механизм удаления мёртвых
ссылок, возникающих в результате редизайна ресурса. Если Вы удаляете страницу,
подключённую к счётчику из структуры Вашего ресурса, не забудьте удалить его из
таблицы pages при помощи гиперссылки "Удалить". 

----------------------------------------------------------------------------
-- Обратная связь                                                         --
----------------------------------------------------------------------------
e-mail: softtime@softtime.ru
Загрузить новые версии счётчика, а так же ряда других полезных Web-приложений можно
по адресу http://www.softtime.ru/info/downloads.php. На форуме IT-студии SoftTime
http://www.softtime.ru/forum/ вы всегда можете найти поддержку по установке и
сопровождению данного Web-приложения.
